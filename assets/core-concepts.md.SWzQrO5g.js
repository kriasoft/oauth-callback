import{_ as k,C as d,c,o as t,j as e,b as h,a2 as n,a as i,w as a,G as r,a3 as p,t as g}from"./chunks/framework.B4Qey3Xv.js";const C=JSON.parse('{"title":"Core Concepts","description":"Master the fundamental concepts and architecture of OAuth Callback, from the authorization flow to token management and MCP integration patterns.","frontmatter":{"title":"Core Concepts","description":"Master the fundamental concepts and architecture of OAuth Callback, from the authorization flow to token management and MCP integration patterns."},"headers":[],"relativePath":"core-concepts.md","filePath":"core-concepts.md"}'),u={name:"core-concepts.md"};function E(o,s,y,A,m,F){const l=d("Mermaid");return t(),c("div",null,[s[7]||(s[7]=e("h1",{id:"top",tabindex:"-1"},[i("Core Concepts "),e("a",{class:"header-anchor",href:"#top","aria-label":'Permalink to "Core Concepts {#top}"'},"​")],-1)),s[8]||(s[8]=e("p",null,[i("Understanding the core concepts behind "),e("strong",null,"OAuth Callback"),i(" will help you build robust OAuth integrations in your CLI tools, desktop applications, and MCP clients. This page covers the fundamental patterns, architectural decisions, and key abstractions that power the library.")],-1)),s[9]||(s[9]=e("h2",{id:"the-authorization-code-flow",tabindex:"-1"},[i("The Authorization Code Flow "),e("a",{class:"header-anchor",href:"#the-authorization-code-flow","aria-label":'Permalink to "The Authorization Code Flow"'},"​")],-1)),s[10]||(s[10]=e("p",null,"OAuth Callback implements the OAuth 2.0 Authorization Code Flow, the most secure flow for applications that can protect client secrets. This flow involves three key participants:",-1)),(t(),h(p,null,{default:a(()=>[r(l,{id:"mermaid-12",class:"mermaid",graph:"flowchart%20LR%0A%20%20%20%20A%5BYour%20App%5D%20--%3E%7CStep%201%3A%20Request%20authorization%7C%20B%5BAuth%20Server%5D%0A%20%20%20%20B%20--%3E%7CStep%202%3A%20User%20authenticates%7C%20C%5BUser%5D%0A%20%20%20%20C%20--%3E%7CStep%203%3A%20Grants%20permission%7C%20B%0A%20%20%20%20B%20--%3E%7CStep%204%3A%20Returns%20code%7C%20A%0A%20%20%20%20A%20--%3E%7CStep%205%3A%20Exchange%20code%7C%20B%0A%20%20%20%20B%20--%3E%7CStep%206%3A%20Returns%20tokens%7C%20A%0A"})]),fallback:a(()=>s[0]||(s[0]=[i(" Loading... ",-1)])),_:1})),s[11]||(s[11]=n(`<h3 id="why-authorization-code-flow" tabindex="-1">Why Authorization Code Flow? <a class="header-anchor" href="#why-authorization-code-flow" aria-label="Permalink to &quot;Why Authorization Code Flow?&quot;">​</a></h3><p>The authorization code flow provides several security benefits:</p><ul><li><strong>No token exposure</strong>: Access tokens never pass through the browser</li><li><strong>Short-lived codes</strong>: Authorization codes expire quickly (typically 10 minutes)</li><li><strong>Server verification</strong>: The auth server can verify the client&#39;s identity</li><li><strong>Refresh capability</strong>: Supports refresh tokens for long-lived access</li></ul><h2 id="the-localhost-callback-pattern" tabindex="-1">The Localhost Callback Pattern <a class="header-anchor" href="#the-localhost-callback-pattern" aria-label="Permalink to &quot;The Localhost Callback Pattern&quot;">​</a></h2><p>The core innovation of OAuth Callback is making the localhost callback pattern trivially simple to implement. This pattern, standardized in <a href="https://www.rfc-editor.org/rfc/rfc8252.html" target="_blank" rel="noreferrer">RFC 8252</a>, solves a fundamental problem: how can native applications receive OAuth callbacks without a public web server?</p><h3 id="the-problem" tabindex="-1">The Problem <a class="header-anchor" href="#the-problem" aria-label="Permalink to &quot;The Problem&quot;">​</a></h3><p>Traditional web applications have public URLs where OAuth providers can send callbacks:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>https://myapp.com/oauth/callback?code=xyz123</span></span></code></pre></div><p>But CLI tools and desktop apps don&#39;t have public URLs. They run on the user&#39;s machine behind firewalls and NAT.</p><h3 id="the-solution" tabindex="-1">The Solution <a class="header-anchor" href="#the-solution" aria-label="Permalink to &quot;The Solution&quot;">​</a></h3><p>OAuth Callback creates a temporary HTTP server on localhost that:</p><ol><li><strong>Binds locally</strong>: Only accepts connections from <code>127.0.0.1</code></li><li><strong>Uses dynamic ports</strong>: Works with any available port</li><li><strong>Auto-terminates</strong>: Shuts down after receiving the callback</li><li><strong>Handles edge cases</strong>: Timeouts, errors, user cancellation</li></ol><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// This single function handles all the complexity</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> result</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getAuthCode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(authorizationUrl);</span></span></code></pre></div><h2 id="architecture-overview" tabindex="-1">Architecture Overview <a class="header-anchor" href="#architecture-overview" aria-label="Permalink to &quot;Architecture Overview&quot;">​</a></h2><p>OAuth Callback is built on a layered architecture that separates concerns and enables flexibility:</p>`,15)),(t(),h(p,null,{default:a(()=>[r(l,{id:"mermaid-92",class:"mermaid",graph:"flowchart%20TD%0A%20%20%20%20subgraph%20%22Application%20Layer%22%0A%20%20%20%20%20%20%20%20A%5BYour%20CLI%2FDesktop%20App%5D%0A%20%20%20%20end%0A%0A%20%20%20%20subgraph%20%22OAuth%20Callback%20Library%22%0A%20%20%20%20%20%20%20%20B%5BgetAuthCode%20Function%5D%0A%20%20%20%20%20%20%20%20C%5BHTTP%20Server%20Module%5D%0A%20%20%20%20%20%20%20%20D%5BBrowser%20Launcher%5D%0A%20%20%20%20%20%20%20%20E%5BError%20Handler%5D%0A%20%20%20%20%20%20%20%20F%5BTemplate%20Engine%5D%0A%20%20%20%20end%0A%0A%20%20%20%20subgraph%20%22MCP%20Integration%20Layer%22%0A%20%20%20%20%20%20%20%20G%5BbrowserAuth%20Provider%5D%0A%20%20%20%20%20%20%20%20H%5BToken%20Storage%5D%0A%20%20%20%20%20%20%20%20I%5BDynamic%20Client%20Registration%5D%0A%20%20%20%20end%0A%0A%20%20%20%20A%20--%3E%20B%0A%20%20%20%20B%20--%3E%20C%0A%20%20%20%20B%20--%3E%20D%0A%20%20%20%20B%20--%3E%20E%0A%20%20%20%20B%20--%3E%20F%0A%20%20%20%20A%20--%3E%20G%0A%20%20%20%20G%20--%3E%20H%0A%20%20%20%20G%20--%3E%20I%0A"})]),fallback:a(()=>s[1]||(s[1]=[i(" Loading... ",-1)])),_:1})),s[12]||(s[12]=n(`<h3 id="core-components" tabindex="-1">Core Components <a class="header-anchor" href="#core-components" aria-label="Permalink to &quot;Core Components&quot;">​</a></h3><h4 id="_1-the-http-server-server-ts" tabindex="-1">1. The HTTP Server (<code>server.ts</code>) <a class="header-anchor" href="#_1-the-http-server-server-ts" aria-label="Permalink to &quot;1. The HTTP Server (\`server.ts\`)&quot;">​</a></h4><p>The heart of OAuth Callback is a lightweight HTTP server that:</p><ul><li>Listens on localhost for the OAuth callback</li><li>Parses query parameters from the redirect</li><li>Serves success/error HTML pages</li><li>Implements proper cleanup on completion</li></ul><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Internally, the server handles:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Request </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">routing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">callback path matching)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Query parameter </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">extraction</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (code, state, error)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> HTML</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> template rendering </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> placeholders</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Graceful shutdown after callback</span></span></code></pre></div><h4 id="_2-the-authorization-handler-getauthcode" tabindex="-1">2. The Authorization Handler (<code>getAuthCode</code>) <a class="header-anchor" href="#_2-the-authorization-handler-getauthcode" aria-label="Permalink to &quot;2. The Authorization Handler (\`getAuthCode\`)&quot;">​</a></h4><p>The main API surface that orchestrates the entire flow:</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> GetAuthCodeOptions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  authorizationUrl</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// OAuth provider URL</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  port</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Server port (default: 3000)</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  timeout</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Timeout in ms (default: 30000)</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  openBrowser</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> boolean</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Auto-open browser (default: true)</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  signal</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AbortSignal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// For cancellation</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ... more options</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h4 id="_3-error-management-oautherror" tabindex="-1">3. Error Management (<code>OAuthError</code>) <a class="header-anchor" href="#_3-error-management-oautherror" aria-label="Permalink to &quot;3. Error Management (\`OAuthError\`)&quot;">​</a></h4><p>Specialized error handling for OAuth-specific failures:</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> OAuthError</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  error</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// OAuth error code</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  error_description</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Human-readable description</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  error_uri</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Link to more information</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>Common OAuth errors are properly typed and handled:</p><ul><li><code>access_denied</code> - User declined authorization</li><li><code>invalid_scope</code> - Requested scope is invalid</li><li><code>server_error</code> - Authorization server error</li><li><code>temporarily_unavailable</code> - Server is overloaded</li></ul><h2 id="token-management" tabindex="-1">Token Management <a class="header-anchor" href="#token-management" aria-label="Permalink to &quot;Token Management&quot;">​</a></h2><p>For applications that need to persist OAuth tokens, OAuth Callback provides a flexible storage abstraction:</p><h3 id="storage-abstraction" tabindex="-1">Storage Abstraction <a class="header-anchor" href="#storage-abstraction" aria-label="Permalink to &quot;Storage Abstraction&quot;">​</a></h3><p>The <code>TokenStore</code> interface enables different storage strategies:</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TokenStore</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Tokens</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> undefined</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">tokens</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Tokens</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  delete</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="built-in-implementations" tabindex="-1">Built-in Implementations <a class="header-anchor" href="#built-in-implementations" aria-label="Permalink to &quot;Built-in Implementations&quot;">​</a></h3><h4 id="in-memory-store" tabindex="-1">In-Memory Store <a class="header-anchor" href="#in-memory-store" aria-label="Permalink to &quot;In-Memory Store&quot;">​</a></h4><p>Ephemeral storage for maximum security:</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> store</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> inMemoryStore</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Tokens exist only during process lifetime</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Perfect for CLI tools that authenticate per-session</span></span></code></pre></div><h4 id="file-store" tabindex="-1">File Store <a class="header-anchor" href="#file-store" aria-label="Permalink to &quot;File Store&quot;">​</a></h4><p>Persistent storage for convenience:</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> store</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fileStore</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;~/.myapp/tokens.json&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Tokens persist across sessions</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Ideal for desktop apps with returning users</span></span></code></pre></div><h3 id="token-lifecycle" tabindex="-1">Token Lifecycle <a class="header-anchor" href="#token-lifecycle" aria-label="Permalink to &quot;Token Lifecycle&quot;">​</a></h3>`,26)),(t(),h(p,null,{default:a(()=>[r(l,{id:"mermaid-197",class:"mermaid",graph:"stateDiagram-v2%0A%20%20%20%20%5B*%5D%20--%3E%20NoToken%3A%20Initial%20State%0A%20%20%20%20NoToken%20--%3E%20Authorizing%3A%20User%20initiates%20OAuth%0A%20%20%20%20Authorizing%20--%3E%20HasToken%3A%20Successful%20auth%0A%20%20%20%20HasToken%20--%3E%20Refreshing%3A%20Token%20expired%0A%20%20%20%20Refreshing%20--%3E%20HasToken%3A%20Token%20refreshed%0A%20%20%20%20HasToken%20--%3E%20NoToken%3A%20User%20logs%20out%0A%20%20%20%20Refreshing%20--%3E%20Authorizing%3A%20Refresh%20failed%0A"})]),fallback:a(()=>s[2]||(s[2]=[i(" Loading... ",-1)])),_:1})),s[13]||(s[13]=n('<h2 id="mcp-integration-pattern" tabindex="-1">MCP Integration Pattern <a class="header-anchor" href="#mcp-integration-pattern" aria-label="Permalink to &quot;MCP Integration Pattern&quot;">​</a></h2><p>The Model Context Protocol (MCP) integration showcases advanced OAuth patterns:</p><h3 id="dynamic-client-registration" tabindex="-1">Dynamic Client Registration <a class="header-anchor" href="#dynamic-client-registration" aria-label="Permalink to &quot;Dynamic Client Registration&quot;">​</a></h3><p>OAuth Callback supports <a href="https://www.rfc-editor.org/rfc/rfc7591.html" target="_blank" rel="noreferrer">RFC 7591</a> Dynamic Client Registration, allowing apps to register OAuth clients on-the-fly:</p>',4)),(t(),h(p,null,{default:a(()=>[r(l,{id:"mermaid-210",class:"mermaid",graph:"sequenceDiagram%0A%20%20%20%20participant%20App%0A%20%20%20%20participant%20OAuth%20Callback%0A%20%20%20%20participant%20Auth%20Server%0A%0A%20%20%20%20App-%3E%3EOAuth%20Callback%3A%20browserAuth()%20(no%20client_id)%0A%20%20%20%20OAuth%20Callback-%3E%3EAuth%20Server%3A%20POST%20%2Fregister%0A%20%20%20%20Auth%20Server-%3E%3EOAuth%20Callback%3A%20Return%20client_id%2C%20client_secret%0A%20%20%20%20OAuth%20Callback-%3E%3EOAuth%20Callback%3A%20Store%20credentials%0A%20%20%20%20OAuth%20Callback-%3E%3EAuth%20Server%3A%20Start%20normal%20OAuth%20flow%0A"})]),fallback:a(()=>s[3]||(s[3]=[i(" Loading... ",-1)])),_:1})),s[14]||(s[14]=n(`<p>This eliminates the need for users to manually register OAuth applications.</p><h3 id="the-provider-pattern" tabindex="-1">The Provider Pattern <a class="header-anchor" href="#the-provider-pattern" aria-label="Permalink to &quot;The Provider Pattern&quot;">​</a></h3><p>The <code>browserAuth()</code> function returns an <code>OAuthClientProvider</code> that integrates with MCP SDK:</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> OAuthClientProvider</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Called by MCP SDK when authentication is needed</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  authenticate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">params</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AuthenticationParams</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AuthenticationResult</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Manages token refresh automatically</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  refreshToken</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">params</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> RefreshParams</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">RefreshResult</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="request-response-lifecycle" tabindex="-1">Request/Response Lifecycle <a class="header-anchor" href="#request-response-lifecycle" aria-label="Permalink to &quot;Request/Response Lifecycle&quot;">​</a></h2><p>Understanding the complete lifecycle helps when debugging OAuth flows:</p>`,6)),(t(),h(p,null,{default:a(()=>[r(l,{id:"mermaid-227",class:"mermaid",graph:"sequenceDiagram%0A%20%20%20%20participant%20User%0A%20%20%20%20participant%20App%0A%20%20%20%20participant%20OAuth%20Callback%0A%20%20%20%20participant%20Browser%0A%20%20%20%20participant%20Auth%20Server%0A%0A%20%20%20%20User-%3E%3EApp%3A%20Run%20command%0A%20%20%20%20App-%3E%3EOAuth%20Callback%3A%20getAuthCode(url)%0A%20%20%20%20OAuth%20Callback-%3E%3EOAuth%20Callback%3A%20Start%20HTTP%20server%0A%20%20%20%20OAuth%20Callback-%3E%3EBrowser%3A%20Open%20auth%20URL%0A%20%20%20%20Browser-%3E%3EAuth%20Server%3A%20GET%20%2Fauthorize%0A%20%20%20%20Auth%20Server-%3E%3EBrowser%3A%20Login%20page%0A%20%20%20%20Browser-%3E%3EUser%3A%20Show%20login%0A%20%20%20%20User-%3E%3EBrowser%3A%20Enter%20credentials%0A%20%20%20%20Browser-%3E%3EAuth%20Server%3A%20POST%20credentials%0A%20%20%20%20Auth%20Server-%3E%3EBrowser%3A%20Consent%20page%0A%20%20%20%20User-%3E%3EBrowser%3A%20Approve%20access%0A%20%20%20%20Auth%20Server-%3E%3EBrowser%3A%20Redirect%20to%20localhost%0A%20%20%20%20Browser-%3E%3EOAuth%20Callback%3A%20GET%20%2Fcallback%3Fcode%3Dxyz%0A%20%20%20%20OAuth%20Callback-%3E%3EBrowser%3A%20Success%20HTML%0A%20%20%20%20OAuth%20Callback-%3E%3EApp%3A%20Return%20%7Bcode%3A%20%22xyz%22%7D%0A%20%20%20%20OAuth%20Callback-%3E%3EOAuth%20Callback%3A%20Shutdown%20server%0A%20%20%20%20App-%3E%3EAuth%20Server%3A%20Exchange%20code%20for%20token%0A%20%20%20%20Auth%20Server-%3E%3EApp%3A%20Return%20access%20token%0A"})]),fallback:a(()=>s[4]||(s[4]=[i(" Loading... ",-1)])),_:1})),s[15]||(s[15]=n(`<h2 id="state-management" tabindex="-1">State Management <a class="header-anchor" href="#state-management" aria-label="Permalink to &quot;State Management&quot;">​</a></h2><p>OAuth Callback handles multiple types of state throughout the flow:</p><h3 id="server-state" tabindex="-1">Server State <a class="header-anchor" href="#server-state" aria-label="Permalink to &quot;Server State&quot;">​</a></h3><p>The HTTP server maintains minimal state:</p><ul><li><strong>Active</strong>: Server is listening for callbacks</li><li><strong>Received</strong>: Callback has been received</li><li><strong>Shutdown</strong>: Server is closing</li></ul><h3 id="oauth-state" tabindex="-1">OAuth State <a class="header-anchor" href="#oauth-state" aria-label="Permalink to &quot;OAuth State&quot;">​</a></h3><p>The OAuth flow tracks:</p><ul><li><strong>Authorization URL</strong>: Where to send the user</li><li><strong>Expected state</strong>: For CSRF validation</li><li><strong>Timeout timer</strong>: For abandonment detection</li><li><strong>Abort signal</strong>: For cancellation support</li></ul><h3 id="token-state" tabindex="-1">Token State <a class="header-anchor" href="#token-state" aria-label="Permalink to &quot;Token State&quot;">​</a></h3><p>When using token storage:</p><ul><li><strong>No tokens</strong>: Need to authenticate</li><li><strong>Valid tokens</strong>: Can make API calls</li><li><strong>Expired tokens</strong>: Need refresh</li><li><strong>Refresh failed</strong>: Need re-authentication</li></ul><h2 id="security-architecture" tabindex="-1">Security Architecture <a class="header-anchor" href="#security-architecture" aria-label="Permalink to &quot;Security Architecture&quot;">​</a></h2><p>Security is built into every layer of OAuth Callback:</p><h3 id="network-security" tabindex="-1">Network Security <a class="header-anchor" href="#network-security" aria-label="Permalink to &quot;Network Security&quot;">​</a></h3><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Localhost-only binding</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">server.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(port, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;127.0.0.1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// IPv6 localhost support</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">server.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(port, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;::1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Reject non-localhost connections</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isLocalhost</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(request.socket.remoteAddress)) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> reject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="oauth-security" tabindex="-1">OAuth Security <a class="header-anchor" href="#oauth-security" aria-label="Permalink to &quot;OAuth Security&quot;">​</a></h3><ul><li><strong>State parameter</strong>: Prevents CSRF attacks</li><li><strong>PKCE support</strong>: Protects authorization codes</li><li><strong>Timeout enforcement</strong>: Limits exposure window</li><li><strong>Automatic cleanup</strong>: Reduces attack surface</li></ul><h3 id="token-security" tabindex="-1">Token Security <a class="header-anchor" href="#token-security" aria-label="Permalink to &quot;Token Security&quot;">​</a></h3><ul><li><strong>Memory storage option</strong>: No persistence</li><li><strong>File permissions</strong>: Restrictive when using file store</li><li><strong>No logging</strong>: Tokens never logged or exposed</li><li><strong>Refresh handling</strong>: Automatic token refresh</li></ul><h2 id="template-system" tabindex="-1">Template System <a class="header-anchor" href="#template-system" aria-label="Permalink to &quot;Template System&quot;">​</a></h2><p>OAuth Callback includes a simple but powerful template system for success/error pages:</p><h3 id="placeholder-substitution" tabindex="-1">Placeholder Substitution <a class="header-anchor" href="#placeholder-substitution" aria-label="Permalink to &quot;Placeholder Substitution&quot;">​</a></h3>`,22)),e("p",null,[s[5]||(s[5]=i("Templates support ",-1)),e("code",null,g(o.placeholder),1),s[6]||(s[6]=i(" syntax:",-1))]),s[16]||(s[16]=n(`<div class="language-html vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">h1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;Error: {{error_description}}&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">h1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span></code></pre></div><p>Placeholders are automatically escaped to prevent XSS attacks.</p><h3 id="built-in-templates" tabindex="-1">Built-in Templates <a class="header-anchor" href="#built-in-templates" aria-label="Permalink to &quot;Built-in Templates&quot;">​</a></h3><p>The library includes professional templates with:</p><ul><li>Animated success checkmark</li><li>Clear error messages</li><li>Responsive design</li><li>Accessibility features</li></ul><h3 id="custom-templates" tabindex="-1">Custom Templates <a class="header-anchor" href="#custom-templates" aria-label="Permalink to &quot;Custom Templates&quot;">​</a></h3><p>Applications can provide custom HTML:</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  successHtml</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&lt;h1&gt;Welcome back!&lt;/h1&gt;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  errorHtml</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&lt;h1&gt;Oops! {{error}}&lt;/h1&gt;&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="cross-runtime-compatibility" tabindex="-1">Cross-Runtime Compatibility <a class="header-anchor" href="#cross-runtime-compatibility" aria-label="Permalink to &quot;Cross-Runtime Compatibility&quot;">​</a></h2><p>OAuth Callback achieves cross-runtime compatibility through Web Standards APIs:</p><h3 id="universal-apis" tabindex="-1">Universal APIs <a class="header-anchor" href="#universal-apis" aria-label="Permalink to &quot;Universal APIs&quot;">​</a></h3><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Using Web Standards instead of Node.js-specific APIs</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Instead of http.IncomingMessage</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Response</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Instead of http.ServerResponse</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> URL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Instead of url.parse()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> URLSearchParams</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Instead of querystring</span></span></code></pre></div><h3 id="runtime-detection" tabindex="-1">Runtime Detection <a class="header-anchor" href="#runtime-detection" aria-label="Permalink to &quot;Runtime Detection&quot;">​</a></h3><p>The library adapts to the runtime environment:</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Node.js</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { createServer } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;node:http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Deno</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Deno.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">serve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ port: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Bun</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Bun.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">serve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ port: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span></code></pre></div><h2 id="performance-considerations" tabindex="-1">Performance Considerations <a class="header-anchor" href="#performance-considerations" aria-label="Permalink to &quot;Performance Considerations&quot;">​</a></h2><p>OAuth Callback is designed for optimal performance:</p><h3 id="fast-startup" tabindex="-1">Fast Startup <a class="header-anchor" href="#fast-startup" aria-label="Permalink to &quot;Fast Startup&quot;">​</a></h3><ul><li>Minimal dependencies (only <code>open</code> package)</li><li>Lazy loading of heavy modules</li><li>Pre-compiled HTML templates</li></ul><h3 id="efficient-memory-use" tabindex="-1">Efficient Memory Use <a class="header-anchor" href="#efficient-memory-use" aria-label="Permalink to &quot;Efficient Memory Use&quot;">​</a></h3><ul><li>Server resources freed immediately after use</li><li>No persistent connections</li><li>Minimal state retention</li></ul><h3 id="quick-response" tabindex="-1">Quick Response <a class="header-anchor" href="#quick-response" aria-label="Permalink to &quot;Quick Response&quot;">​</a></h3><ul><li>Immediate browser redirect handling</li><li>Non-blocking I/O operations</li><li>Parallel browser launch and server start</li></ul><h2 id="extension-points" tabindex="-1">Extension Points <a class="header-anchor" href="#extension-points" aria-label="Permalink to &quot;Extension Points&quot;">​</a></h2><p>While OAuth Callback provides sensible defaults, it offers multiple extension points:</p><h3 id="custom-storage" tabindex="-1">Custom Storage <a class="header-anchor" href="#custom-storage" aria-label="Permalink to &quot;Custom Storage&quot;">​</a></h3><p>Implement the <code>TokenStore</code> interface for custom storage:</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> RedisStore</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> implements</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TokenStore</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  async</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /* Redis logic */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  async</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">tokens</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Tokens</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /* Redis logic */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  async</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> delete</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /* Redis logic */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="request-interception" tabindex="-1">Request Interception <a class="header-anchor" href="#request-interception" aria-label="Permalink to &quot;Request Interception&quot;">​</a></h3><p>Monitor or modify requests with callbacks:</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  onRequest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`OAuth: \${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">req</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">method</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">} \${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">req</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">url</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Add telemetry, logging, etc.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  };</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="browser-control" tabindex="-1">Browser Control <a class="header-anchor" href="#browser-control" aria-label="Permalink to &quot;Browser Control&quot;">​</a></h3><p>Customize browser launching:</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  openBrowser</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Manual browser opening</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Or provide custom launcher</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="best-practices" tabindex="-1">Best Practices <a class="header-anchor" href="#best-practices" aria-label="Permalink to &quot;Best Practices&quot;">​</a></h2><h3 id="error-handling" tabindex="-1">Error Handling <a class="header-anchor" href="#error-handling" aria-label="Permalink to &quot;Error Handling&quot;">​</a></h3><p>Always handle both OAuth errors and unexpected failures:</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> result</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getAuthCode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(authUrl);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (error) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (error </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">instanceof</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> OAuthError</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Handle OAuth-specific errors</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Handle unexpected errors</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="state-validation" tabindex="-1">State Validation <a class="header-anchor" href="#state-validation" aria-label="Permalink to &quot;State Validation&quot;">​</a></h3><p>Always validate the state parameter:</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> state</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> crypto.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">randomUUID</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Include in auth URL</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> result</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getAuthCode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(authUrl);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (result.state </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> state) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">throw</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;CSRF detected&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><h3 id="token-storage" tabindex="-1">Token Storage <a class="header-anchor" href="#token-storage" aria-label="Permalink to &quot;Token Storage&quot;">​</a></h3><p>Choose storage based on security requirements:</p><ul><li><strong>CLI tools</strong>: Use <code>inMemoryStore()</code> for per-session auth</li><li><strong>Desktop apps</strong>: Use <code>fileStore()</code> for user convenience</li><li><strong>Sensitive apps</strong>: Always use in-memory storage</li></ul><h3 id="timeout-configuration" tabindex="-1">Timeout Configuration <a class="header-anchor" href="#timeout-configuration" aria-label="Permalink to &quot;Timeout Configuration&quot;">​</a></h3><p>Set appropriate timeouts for your use case:</p><ul><li><strong>Interactive apps</strong>: 30-60 seconds</li><li><strong>Automated tools</strong>: 5-10 seconds</li><li><strong>First-time setup</strong>: 2-5 minutes</li></ul>`,47))])}const f=k(u,[["render",E]]);export{C as __pageData,f as default};
